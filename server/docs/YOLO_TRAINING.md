# Обучение YOLOv8 для детекции области счетчика

## Проблема

Предобученная модель YOLOv8 не знает, что такое счетчик. Для достижения 99% точности нужно обучить кастомную модель на ваших данных.

## Шаги для обучения

### 1. Сбор данных (40-300 изображений)

Соберите изображения ваших счетчиков:
- Разные типы счетчиков (газ, вода, электричество)
- Разные углы съемки
- Разное освещение
- Разные модели счетчиков

Структура папок:
```
dataset/
├── images/
│   ├── train/
│   │   ├── meter_001.jpg
│   │   ├── meter_002.jpg
│   │   └── ...
│   └── val/
│       ├── meter_101.jpg
│       └── ...
└── labels/
    ├── train/
    │   ├── meter_001.txt
    │   ├── meter_002.txt
    │   └── ...
    └── val/
        ├── meter_101.txt
        └── ...
```

### 2. Разметка данных

Используйте инструмент для разметки (например, [LabelImg](https://github.com/HumanSignal/labelImg) или [Roboflow](https://roboflow.com/)):

1. Откройте изображение
2. Нарисуйте bounding box вокруг области показаний счетчика
3. Создайте класс "meter_display"
4. Сохраните в формате YOLO (текстовый файл с координатами)

Формат YOLO label файла (`meter_001.txt`):
```
0 0.5 0.3 0.4 0.2
```
Где:
- `0` - класс (meter_display)
- `0.5 0.3` - центр bounding box (нормализованные координаты)
- `0.4 0.2` - ширина и высота (нормализованные)

### 3. Создание конфигурации

Создайте файл `dataset.yaml`:
```yaml
path: /path/to/dataset
train: images/train
val: images/val

names:
  0: meter_display
```

### 4. Обучение модели

```python
from ultralytics import YOLO

# Загрузите предобученную модель
model = YOLO('yolov8n.pt')  # или yolov8s.pt, yolov8m.pt для большей точности

# Обучите модель
results = model.train(
    data='dataset.yaml',
    epochs=100,
    imgsz=640,
    batch=16,
    name='meter_detector'
)
```

### 5. Использование обученной модели

После обучения модель будет сохранена в `runs/detect/meter_detector/weights/best.pt`.

Обновите `server/app/ocr/processor.py`:
```python
self.yolo_model = YOLO('runs/detect/meter_detector/weights/best.pt')
```

Или укажите путь к модели в конфигурации.

## Альтернативные варианты

### Использование Roboflow

1. Загрузите изображения на [Roboflow](https://roboflow.com/)
2. Разметьте данные онлайн
3. Экспортируйте в формате YOLOv8
4. Скачайте готовый датасет

### Использование готовых моделей

Если у вас есть доступ к готовым моделям для детекции счетчиков, просто укажите путь к модели в коде.

## Рекомендации

- **Минимум данных**: 40-50 изображений (может быть достаточно для начала)
- **Оптимально**: 100-200 изображений
- **Для продакшена**: 200-300+ изображений с хорошим разнообразием

- Используйте data augmentation (аугментация данных) для увеличения датасета
- Разделите данные: 80% train, 20% validation
- Обучайте на разных размерах моделей (nano, small, medium) и выберите лучшую

## Проверка качества

После обучения проверьте метрики:
- mAP50 (mean Average Precision) - должна быть > 0.9 для хорошей модели
- Precision и Recall

```python
# Валидация модели
results = model.val()
print(f"mAP50: {results.box.map50}")
```

