# OCR Architecture - Frame Detection + OCR

## Текущая архитектура

Реализована архитектура, используемая в реальных utility-apps для достижения 99% точности:

```
1. Frame Detection (YOLOv8) → 2. Image Cropping → 3. OCR (EasyOCR/Tesseract)
```

### Компоненты

1. **YOLOv8 Frame Detection** (первичный метод)
   - Детектирует область счетчика на изображении
   - Обрезает изображение, убирая фон, блики и мусор
   - Fallback на контурную детекцию, если YOLO недоступен

2. **EasyOCR** (первичный OCR)
   - Работает на обрезанной области
   - Лучше распознает цифры на дисплеях
   - Учитывает позицию и длину последовательностей

3. **Tesseract OCR** (fallback)
   - Используется, если EasyOCR не дал результата
   - Множественные PSM режимы для лучшего распознавания

## Использование кастомной модели YOLOv8

После обучения кастомной модели на ваших данных:

1. Установите переменную окружения:
```bash
export YOLO_METER_MODEL_PATH=/path/to/your/model/best.pt
```

2. Или добавьте в `.env`:
```
YOLO_METER_MODEL_PATH=/path/to/your/model/best.pt
```

3. Перезапустите сервер

## Текущий статус

✅ YOLOv8 интегрирован  
✅ EasyOCR интегрирован  
✅ Fallback на контурную детекцию работает  
✅ Fallback на Tesseract работает  
⚠️ Используется предобученная YOLOv8 модель (не знает счетчики)  
⚠️ Нужна кастомная модель для 99% точности  

## Следующие шаги

1. Собрать 40-300 изображений счетчиков
2. Разметить их (bounding boxes вокруг области показаний)
3. Обучить YOLOv8 на этих данных
4. Использовать обученную модель через `YOLO_METER_MODEL_PATH`

См. `YOLO_TRAINING.md` для подробных инструкций по обучению.

